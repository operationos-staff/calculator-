<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç—É—Ä–æ–≤ ‚Äî –ü—Ö–∞–Ω–≥ –ù–≥–∞</title>
  <link rel="icon" href="data:,">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #0F4C75;
    --primary-light: #1B6CA8;
    --accent: #F4A621;
    --accent-light: #FFB84D;
    --success: #10B981;
    --danger: #EF4444;
    --bg: #F0F5FA;
    --card: #FFFFFF;
    --text: #1E293B;
    --text-light: #64748B;
    --border: #E2E8F0;
    --shadow: 0 4px 24px rgba(15,76,117,0.10);
    --shadow-lg: 0 8px 40px rgba(15,76,117,0.15);
    --radius: 16px;
    --radius-sm: 10px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* ===== HEADER ===== */
  .header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 20px rgba(15,76,117,0.3);
  }
  .header-inner {
    max-width: 1280px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    gap: 16px;
  }
  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: white;
  }
  .logo-icon {
    width: 44px; height: 44px;
    background: rgba(255,255,255,0.2);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
  }
  .logo-text { line-height: 1.2; }
  .logo-title { font-size: 18px; font-weight: 700; letter-spacing: -0.3px; }
  .logo-sub { font-size: 12px; opacity: 0.75; font-weight: 400; }
  .header-nav { display: flex; gap: 8px; align-items: center; }
  .btn-nav {
    padding: 8px 18px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 6px;
  }
  .btn-nav-outline {
    background: rgba(255,255,255,0.15);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
  }
  .btn-nav-outline:hover { background: rgba(255,255,255,0.25); }
  .btn-nav-accent {
    background: var(--accent);
    color: var(--primary);
    font-weight: 700;
  }
  .btn-nav-accent:hover { background: var(--accent-light); transform: translateY(-1px); }

  /* ===== LAYOUT ===== */
  .main {
    max-width: 1280px;
    margin: 0 auto;
    padding: 32px 24px;
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 24px;
  }
  @media(max-width:900px){ .main{ grid-template-columns:1fr; } }

  /* ===== PAGES ===== */
  .page { display: none; }
  .page.active { display: block; }

  /* ===== CARDS ===== */
  .card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .card-header {
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .card-header-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    color: white;
  }
  .card-header-text h2 { font-size: 16px; font-weight: 700; color: var(--text); }
  .card-header-text p { font-size: 12px; color: var(--text-light); margin-top: 2px; }
  .card-body { padding: 24px; }

  /* ===== PACKAGE SELECTION ===== */
  .packages-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }
  @media(max-width:600px){ .packages-grid{ grid-template-columns:1fr; } }
  .pkg-card {
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    background: white;
  }
  .pkg-card:hover { border-color: var(--primary-light); box-shadow: 0 4px 16px rgba(15,76,117,0.1); }
  .pkg-card.selected {
    border-color: var(--primary);
    background: linear-gradient(135deg, #EBF5FF, #DBEAFE);
  }
  .pkg-card.selected::after {
    content: '‚úì';
    position: absolute;
    top: 10px; right: 12px;
    background: var(--primary);
    color: white;
    width: 22px; height: 22px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
  }
  .pkg-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
    background: var(--bg);
    color: var(--text-light);
  }
  .pkg-card.vip .pkg-badge { background: linear-gradient(135deg,#FFD700,#FFA500); color: white; }
  .pkg-name { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; line-height: 1.4; }
  .pkg-note { font-size: 11px; color: var(--text-light); margin-bottom: 10px; }
  .pkg-price { font-size: 20px; font-weight: 800; color: var(--primary); }
  .pkg-price span { font-size: 12px; font-weight: 500; color: var(--text-light); }

  /* ===== OPTIONS SECTION ===== */
  .section-title {
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }
  .section-title .badge {
    background: var(--primary);
    color: white;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 11px;
  }

  /* ===== CATEGORY FILTER ===== */
  .cat-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }
  .cat-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: white;
    color: var(--text-light);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 5px;
  }
  .cat-btn:hover, .cat-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  /* ===== OPTIONS TABLE ===== */
  .options-table { width: 100%; border-collapse: collapse; }
  .options-table thead th {
    background: var(--bg);
    padding: 10px 12px;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-light);
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
  }
  .options-table thead th:last-child,
  .options-table thead th:nth-last-child(2),
  .options-table thead th:nth-last-child(3) { text-align: center; }
  .opt-row {
    border-bottom: 1px solid #F1F5F9;
    transition: background 0.15s;
  }
  .opt-row:hover { background: #F8FAFF; }
  .opt-row.has-qty { background: #F0FDF4; }
  .opt-row td { padding: 10px 12px; vertical-align: middle; }
  .opt-name { font-size: 13px; font-weight: 500; color: var(--text); }
  .opt-cat-tag {
    display: inline-block;
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 3px;
    font-weight: 500;
    margin-top: 2px;
  }
  .opt-price { font-size: 13px; font-weight: 600; color: var(--primary); text-align: center; }
  .opt-price-free { color: var(--success); font-weight: 600; font-size: 12px; }
  .qty-input {
    width: 60px;
    padding: 6px 8px;
    border: 1.5px solid var(--border);
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    outline: none;
    transition: border-color 0.2s;
    background: white;
  }
  .qty-input:focus { border-color: var(--primary); }
  .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; }
  .opt-sum { font-size: 13px; font-weight: 700; color: var(--primary); text-align: center; min-width: 70px; }
  .opt-sum.zero { color: var(--text-light); font-weight: 400; }

  /* ===== SIDEBAR / SUMMARY ===== */
  .sidebar { display: flex; flex-direction: column; gap: 16px; }
  .client-form .field { margin-bottom: 14px; }
  .client-form label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-light);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.4px;
  }
  .client-form input, .client-form select, .client-form textarea {
    width: 100%;
    padding: 10px 14px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-size: 13px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
    background: white;
    color: var(--text);
  }
  .client-form input:focus, .client-form select:focus, .client-form textarea:focus {
    border-color: var(--primary);
  }
  .client-form textarea { resize: vertical; min-height: 70px; }

  /* ===== SUMMARY BOX ===== */
  .summary-lines { margin-bottom: 16px; }
  .sum-line {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0;
    border-bottom: 1px dashed var(--border);
    font-size: 13px;
  }
  .sum-line:last-child { border-bottom: none; }
  .sum-line .label { color: var(--text-light); }
  .sum-line .val { font-weight: 600; color: var(--text); }
  .sum-line .val.pos { color: var(--success); }
  .sum-total {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    border-radius: var(--radius-sm);
    padding: 16px;
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 16px;
  }
  .sum-total .t-label { font-size: 14px; font-weight: 600; opacity: 0.9; }
  .sum-total .t-amount { font-size: 24px; font-weight: 800; }
  .sum-total .t-cur { font-size: 12px; opacity: 0.8; }

  /* ===== MARKUP (admin only) ===== */
  .markup-row {
    display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    margin-bottom: 12px;
  }
  .markup-field { position: relative; }
  .markup-field input {
    width: 100%;
    padding: 9px 32px 9px 12px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    outline: none;
  }
  .markup-field input:focus { border-color: var(--accent); }
  .markup-field .suffix {
    position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
    font-size: 12px; font-weight: 700; color: var(--text-light);
  }
  .markup-label { font-size: 11px; color: var(--text-light); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; }

  /* ===== ACTION BUTTONS ===== */
  .action-btns { display: flex; flex-direction: column; gap: 10px; }
  .btn {
    width: 100%;
    padding: 13px 20px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    font-family: inherit;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    box-shadow: 0 4px 15px rgba(15,76,117,0.3);
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(15,76,117,0.4); }
  .btn-accent {
    background: linear-gradient(135deg, var(--accent), var(--accent-light));
    color: white;
    box-shadow: 0 4px 15px rgba(244,166,33,0.3);
  }
  .btn-accent:hover { transform: translateY(-1px); }
  .btn-outline {
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
  }
  .btn-outline:hover { background: var(--primary); color: white; }
  .btn-success {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
  }
  .btn-success:hover { transform: translateY(-1px); }
  .btn-gray {
    background: var(--bg);
    color: var(--text-light);
    border: 1px solid var(--border);
  }
  .btn-gray:hover { background: var(--border); }

  /* ===== SELECTED OPTIONS PREVIEW ===== */
  .selected-opts { display: flex; flex-direction: column; gap: 6px; }
  .sel-opt {
    display: flex; justify-content: space-between; align-items: flex-start;
    background: #F8FAFF;
    border: 1px solid #DBEAFE;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
  }
  .sel-opt-name { font-weight: 500; color: var(--text); flex: 1; }
  .sel-opt-detail { font-size: 11px; color: var(--text-light); margin-top: 2px; }
  .sel-opt-price { font-weight: 700; color: var(--primary); white-space: nowrap; margin-left: 8px; }

  /* ===== SHARE LINK ===== */
  .link-box {
    display: flex; gap: 8px;
    margin-top: 8px;
  }
  .link-input {
    flex: 1;
    padding: 9px 12px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-size: 12px;
    background: var(--bg);
    outline: none;
    color: var(--text-light);
  }
  .btn-copy {
    padding: 9px 16px;
    border-radius: 8px;
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
  }
  .btn-copy:hover { background: var(--primary-light); }

  /* ===== MODAL ===== */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(15,76,117,0.5);
    backdrop-filter: blur(4px);
    z-index: 1000;
    align-items: center; justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: white;
    border-radius: var(--radius);
    padding: 32px;
    max-width: 520px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
  }
  .modal-close {
    position: absolute; top: 16px; right: 16px;
    background: var(--bg); border: none; cursor: pointer;
    width: 32px; height: 32px; border-radius: 50%;
    font-size: 16px; display: flex; align-items: center; justify-content: center;
    color: var(--text-light);
  }
  .modal-close:hover { background: var(--border); }
  .modal-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
  .modal-sub { font-size: 13px; color: var(--text-light); margin-bottom: 24px; }

  /* ===== TEXT FORMAT MODAL ===== */
  .text-output {
    background: var(--bg);
    border-radius: 10px;
    padding: 16px;
    font-size: 13px;
    line-height: 1.7;
    white-space: pre-wrap;
    font-family: 'Courier New', monospace;
    max-height: 350px;
    overflow-y: auto;
    color: var(--text);
    border: 1px solid var(--border);
    margin-bottom: 16px;
  }

  /* ===== ADMIN PANEL ===== */
  #page-admin .main-inner {
    max-width: 1100px; margin: 0 auto;
  }
  .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  @media(max-width:700px){ .admin-grid{ grid-template-columns:1fr; } }
  .price-editor td { padding: 8px 10px; }
  .price-editor input {
    width: 100%; padding: 6px 8px; border: 1.5px solid var(--border);
    border-radius: 6px; font-size: 12px; text-align: right; font-weight: 600;
    outline: none;
  }
  .price-editor input:focus { border-color: var(--accent); }
  .price-editor .name-col { font-size: 12px; font-weight: 500; }
  .price-editor th {
    background: var(--bg); font-size: 10px; font-weight: 700;
    color: var(--text-light); text-transform: uppercase; padding: 8px 10px;
  }
  .admin-tabs { display: flex; gap: 4px; margin-bottom: 20px; }
  .admin-tab {
    padding: 9px 18px; border-radius: 8px; border: 1px solid var(--border);
    background: white; font-size: 13px; font-weight: 500; cursor: pointer;
    transition: all 0.2s;
  }
  .admin-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
  .admin-tab-content { display: none; }
  .admin-tab-content.active { display: block; }

  /* ===== TOAST ===== */
  .toast {
    position: fixed; bottom: 24px; right: 24px;
    background: var(--text); color: white;
    padding: 12px 20px; border-radius: 10px;
    font-size: 13px; font-weight: 500;
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    display: flex; align-items: center; gap: 8px;
    transform: translateY(100px); opacity: 0;
    transition: all 0.3s;
  }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.success { background: var(--success); }
  .toast.error { background: var(--danger); }

  /* ===== PRINT / PDF ===== */
  .pdf-content {
    font-family: 'Inter', sans-serif;
    padding: 32px;
    max-width: 700px;
    margin: 0 auto;
    color: #1E293B;
  }
  .pdf-logo-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
  .pdf-company { font-size: 20px; font-weight: 800; color: #0F4C75; }
  .pdf-date { font-size: 12px; color: #64748B; }
  .pdf-title { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
  .pdf-client-info { background: #F0F5FA; border-radius: 10px; padding: 16px; margin-bottom: 24px; }
  .pdf-client-row { display: flex; gap: 8px; font-size: 13px; margin-bottom: 4px; }
  .pdf-client-key { font-weight: 600; color: #64748B; min-width: 80px; }
  .pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  .pdf-table th { background: #0F4C75; color: white; padding: 10px 12px; font-size: 12px; text-align: left; }
  .pdf-table td { padding: 9px 12px; border-bottom: 1px solid #E2E8F0; font-size: 12px; }
  .pdf-table tr:nth-child(even) td { background: #F8FAFF; }
  .pdf-total { background: #0F4C75; color: white; border-radius: 10px; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; }
  .pdf-total-label { font-size: 14px; font-weight: 600; }
  .pdf-total-amount { font-size: 26px; font-weight: 800; }

  /* ===== RESPONSIVE ===== */
  @media(max-width:640px) {
    .header-inner { padding: 12px 16px; }
    .logo-sub { display: none; }
    .main { padding: 16px; gap: 16px; }
    .card-body { padding: 16px; }
  }

  /* ===== ROLE BADGE ===== */
  .role-badge {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: 20px;
    font-size: 11px; font-weight: 600;
  }
  .role-manager { background: #DBEAFE; color: #1D4ED8; }
  .role-booking { background: #FEF3C7; color: #92400E; }
  .role-admin { background: #FCE7F3; color: #9D174D; }

  .empty-state {
    text-align: center; padding: 32px; color: var(--text-light);
  }
  .empty-state .icon { font-size: 40px; margin-bottom: 8px; }
  .empty-state p { font-size: 13px; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: #F1F5F9; }
  ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }

  .divider { height: 1px; background: var(--border); margin: 16px 0; }

  .info-chip {
    display: inline-flex; align-items: center; gap: 5px;
    background: #EBF5FF; color: #1D4ED8;
    padding: 4px 10px; border-radius: 6px;
    font-size: 11px; font-weight: 600;
  }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="header">
  <div class="header-inner">
    <a class="logo" href="#" onclick="showPage('calculator')">
      <div class="logo-icon">üå¥</div>
      <div class="logo-text">
        <div class="logo-title">–ü—Ö–∞–Ω–≥ –ù–≥–∞ –¢—É—Ä—ã</div>
        <div class="logo-sub">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç—É—Ä–æ–≤</div>
      </div>
    </a>
    <nav class="header-nav">
      <span id="role-display" class="role-badge role-manager">üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä</span>
      <button class="btn-nav btn-nav-outline" onclick="showPage('calculator')">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
      <button class="btn-nav btn-nav-outline" id="btn-admin-nav" onclick="showAdminLogin()" style="display:none">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
      <button class="btn-nav btn-nav-accent" onclick="showAdminLogin()">üîê –í–æ–π—Ç–∏</button>
    </nav>
  </div>
</header>

<!-- ===== LOGIN MODAL ===== -->
<div class="modal-overlay" id="loginModal">
  <div class="modal" style="max-width:400px">
    <button class="modal-close" onclick="closeModal('loginModal')">‚úï</button>
    <div class="modal-title">üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</div>
    <div class="modal-sub">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –∏ –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</div>
    <div class="client-form">
      <div class="field">
        <label>–†–æ–ª—å</label>
        <select id="login-role">
          <option value="manager">üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</option>
          <option value="booking">üìã –û—Ç–¥–µ–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</option>
          <option value="admin">‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
        </select>
      </div>
      <div class="field">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="login-pass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." onkeyup="if(event.key==='Enter')doLogin()">
        <div style="font-size:11px;color:#999;margin-top:4px">Demo: manager / booking / admin</div>
      </div>
      <button class="btn btn-primary" onclick="doLogin()">–í–æ–π—Ç–∏ ‚Üí</button>
    </div>
  </div>
</div>

<!-- ===== TEXT FORMAT MODAL ===== -->
<div class="modal-overlay" id="textModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('textModal')">‚úï</button>
    <div class="modal-title">üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç</div>
    <div class="modal-sub">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</div>
    <div class="text-output" id="textOutput"></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-primary" style="flex:1" onclick="copyText()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn btn-outline" style="flex:1" onclick="closeModal('textModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<!-- ===== SHARE LINK MODAL ===== -->
<div class="modal-overlay" id="linkModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('linkModal')">‚úï</button>
    <div class="modal-title">üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞</div>
    <div class="modal-sub">–ö–ª–∏–µ–Ω—Ç —É–≤–∏–¥–∏—Ç —Ä–∞—Å—á—ë—Ç —Ç—É—Ä–∞ –≤ –∫—Ä–∞—Å–∏–≤–æ–º –≤–∏–¥–µ, –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
    <div style="margin-bottom:20px">
      <div style="font-size:12px;font-weight:600;color:var(--text-light);margin-bottom:8px">–°–°–´–õ–ö–ê</div>
      <div class="link-box">
        <input type="text" class="link-input" id="shareUrlInput" readonly>
        <button class="btn-copy" onclick="copyLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
    <div style="background:#F0FDF4;border-radius:10px;padding:14px;font-size:12px;color:#065F46;border:1px solid #A7F3D0">
      ‚úÖ –°—Å—ã–ª–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫–ª–∏–µ–Ω—Ç —É–≤–∏–¥–∏—Ç –ø–æ–ª–Ω—ã–π —Ä–∞—Å—á—ë—Ç.
    </div>
  </div>
</div>

<!-- ===== CLIENT VIEW MODAL ===== -->
<div class="modal-overlay" id="clientViewModal">
  <div class="modal" style="max-width:600px">
    <button class="modal-close" onclick="closeModal('clientViewModal')">‚úï</button>
    <div id="clientViewContent"></div>
    <div style="display:flex;gap:10px;margin-top:20px">
      <button class="btn btn-primary" style="flex:1" onclick="downloadClientPDF()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å PDF</button>
      <button class="btn btn-gray" style="flex:1" onclick="closeModal('clientViewModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<!-- ===== PAGES ===== -->

<!-- PAGE: CALCULATOR -->
<div class="page active" id="page-calculator">
  <div class="main">
    <!-- LEFT COLUMN -->
    <div>
      <!-- BASE PACKAGES -->
      <div class="card" style="margin-bottom:20px">
        <div class="card-header">
          <div class="card-header-icon">üöê</div>
          <div class="card-header-text">
            <h2>–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –ø–∞–∫–µ—Ç ‚Äî –æ—Å–Ω–æ–≤–∞ —Ç—É—Ä–∞</p>
          </div>
        </div>
        <div class="card-body">
          <div class="packages-grid" id="packagesGrid"></div>
        </div>
      </div>

      <!-- OPTIONS -->
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon">üéØ</div>
          <div class="card-header-text">
            <h2>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</h2>
            <p>–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö –∏ –¥–µ—Ç–µ–π</p>
          </div>
        </div>
        <div class="card-body">
          <div class="cat-filters" id="catFilters"></div>
          <div style="overflow-x:auto">
            <table class="options-table">
              <thead>
                <tr>
                  <th>–û–ø—Ü–∏—è</th>
                  <th style="text-align:center">–í–∑—Ä.</th>
                  <th style="text-align:center">–î–µ—Ç.</th>
                  <th style="text-align:center">–¶–µ–Ω–∞ –≤–∑—Ä.</th>
                  <th style="text-align:center">–¶–µ–Ω–∞ –¥–µ—Ç.</th>
                  <th style="text-align:center">–°—É–º–º–∞</th>
                </tr>
              </thead>
              <tbody id="optionsBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: SIDEBAR -->
    <div class="sidebar">
      <!-- CLIENT INFO -->
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon">üë§</div>
          <div class="card-header-text">
            <h2>–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—á—ë—Ç–∞</p>
          </div>
        </div>
        <div class="card-body">
          <div class="client-form">
            <div class="field">
              <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
              <input type="text" id="clientName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" oninput="updateSummary()">
            </div>
            <div class="field">
              <label>–î–∞—Ç–∞ —Ç—É—Ä–∞</label>
              <input type="date" id="tourDate" oninput="updateSummary()">
            </div>
            <div class="field">
              <label>–¢–µ–ª–µ—Ñ–æ–Ω / WhatsApp</label>
              <input type="text" id="clientPhone" placeholder="+66 XX XXX XXXX" oninput="updateSummary()">
            </div>
            <div class="field">
              <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
              <textarea id="clientNote" placeholder="–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..." oninput="updateSummary()"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- MARKUP (booking/admin only) -->
      <div class="card" id="markupCard" style="display:none">
        <div class="card-header">
          <div class="card-header-icon" style="background:linear-gradient(135deg,#F59E0B,#D97706)">üí∞</div>
          <div class="card-header-text">
            <h2>–ù–∞—Ü–µ–Ω–∫–∞ –Ω–∞ —Ç—É—Ä</h2>
            <p>–¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–¥–µ–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
          </div>
        </div>
        <div class="card-body">
          <div class="markup-row">
            <div>
              <div class="markup-label">–ù–∞—Ü–µ–Ω–∫–∞ %</div>
              <div class="markup-field">
                <input type="number" id="markupPct" value="0" min="0" max="200" oninput="updateSummary()">
                <span class="suffix">%</span>
              </div>
            </div>
            <div>
              <div class="markup-label">–ù–∞—Ü–µ–Ω–∫–∞ –±–∞—Ç</div>
              <div class="markup-field">
                <input type="number" id="markupBat" value="0" min="0" oninput="updateSummary()">
                <span class="suffix">‡∏ø</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SUMMARY -->
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon" style="background:linear-gradient(135deg,#10B981,#059669)">üí≥</div>
          <div class="card-header-text">
            <h2>–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</h2>
            <p>–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
          </div>
        </div>
        <div class="card-body">
          <div class="summary-lines" id="summaryLines">
            <div class="sum-line">
              <span class="label">–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</span>
              <span class="val" id="sumPackage">0 ‡∏ø</span>
            </div>
            <div class="sum-line">
              <span class="label">–î–æ–ø. –æ–ø—Ü–∏–∏</span>
              <span class="val" id="sumOptions">0 ‡∏ø</span>
            </div>
            <div class="sum-line" id="sumMarkupRow" style="display:none">
              <span class="label">–ù–∞—Ü–µ–Ω–∫–∞</span>
              <span class="val pos" id="sumMarkup">0 ‡∏ø</span>
            </div>
          </div>
          <div class="sum-total">
            <div>
              <div class="t-label">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
              <div class="t-cur">—Ç–∞–π—Å–∫–∏—Ö –±–∞—Ç (THB)</div>
            </div>
            <div class="t-amount" id="sumTotal">0 ‡∏ø</div>
          </div>

          <div style="margin-bottom:14px">
            <div class="section-title" style="margin-bottom:10px">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏</div>
            <div id="selectedOptsList">
              <div class="empty-state">
                <div class="icon">üéØ</div>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –æ–ø—Ü–∏–∏</p>
              </div>
            </div>
          </div>

          <div class="action-btns">
            <button class="btn btn-primary" onclick="downloadPDF()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å PDF</button>
            <button class="btn btn-accent" onclick="showTextFormat()">üì± –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç</button>
            <button class="btn btn-success" onclick="generateLink()">üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞</button>
            <button class="btn btn-gray" onclick="resetAll()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: ADMIN -->
<div class="page" id="page-admin">
  <div style="max-width:1100px;margin:0 auto;padding:32px 24px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <div>
        <h1 style="font-size:22px;font-weight:800;margin-bottom:4px">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <p style="font-size:13px;color:var(--text-light)">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏, –Ω–∞—Ü–µ–Ω–∫–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞</p>
      </div>
      <button class="btn btn-primary" onclick="saveAdminSettings()" style="width:auto;padding:12px 24px">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </div>

    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchAdminTab('prices')">üí∞ –¶–µ–Ω—ã –ø–∞–∫–µ—Ç–æ–≤</button>
      <button class="admin-tab" onclick="switchAdminTab('options')">üéØ –¶–µ–Ω—ã –æ–ø—Ü–∏–π</button>
      <button class="admin-tab" onclick="switchAdminTab('markup')">üìä –ù–∞—Ü–µ–Ω–∫–∏</button>
      <button class="admin-tab" onclick="switchAdminTab('access')">üîê –î–æ—Å—Ç—É–ø—ã</button>
    </div>

    <!-- TAB: PRICES -->
    <div class="admin-tab-content active" id="tab-prices">
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon">üöê</div>
          <div class="card-header-text"><h2>–ë–∞–∑–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã</h2><p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –∏ –æ–ø–∏—Å–∞–Ω–∏–π</p></div>
        </div>
        <div class="card-body" style="overflow-x:auto">
          <table class="price-editor" style="width:100%;border-collapse:collapse">
            <thead><tr>
              <th>‚Ññ</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞</th><th>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ (‡∏ø)</th><th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
            </tr></thead>
            <tbody id="adminPackagesTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: OPTIONS -->
    <div class="admin-tab-content" id="tab-options">
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon">üéØ</div>
          <div class="card-header-text"><h2>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</h2><p>–¶–µ–Ω—ã –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö –∏ –¥–µ—Ç–µ–π</p></div>
        </div>
        <div class="card-body" style="overflow-x:auto">
          <table class="price-editor" style="width:100%;border-collapse:collapse">
            <thead><tr>
              <th>‚Ññ</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–∏</th><th>–í–∑—Ä–æ—Å–ª—ã–π (‡∏ø)</th><th>–†–µ–±—ë–Ω–æ–∫ (‡∏ø)</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            </tr></thead>
            <tbody id="adminOptionsTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: MARKUP -->
    <div class="admin-tab-content" id="tab-markup">
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon" style="background:linear-gradient(135deg,#F59E0B,#D97706)">üìä</div>
          <div class="card-header-text"><h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ü–µ–Ω–æ–∫</h2><p>–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Ü–µ–Ω–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</p></div>
        </div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:500px">
            <div>
              <div class="markup-label">–ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é %</div>
              <div class="markup-field">
                <input type="number" id="defaultMarkupPct" value="0" min="0" max="200" onchange="saveToStorage()">
                <span class="suffix">%</span>
              </div>
            </div>
            <div>
              <div class="markup-label">–ù–∞—Ü–µ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–∞—Ç</div>
              <div class="markup-field">
                <input type="number" id="defaultMarkupBat" value="0" min="0" onchange="saveToStorage()">
                <span class="suffix">‡∏ø</span>
              </div>
            </div>
          </div>
          <div style="margin-top:20px;padding:16px;background:#FEF3C7;border-radius:10px;font-size:13px;color:#92400E">
            ‚ö†Ô∏è –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –æ—Ç–¥–µ–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: ACCESS -->
    <div class="admin-tab-content" id="tab-access">
      <div class="card">
        <div class="card-header">
          <div class="card-header-icon" style="background:linear-gradient(135deg,#8B5CF6,#7C3AED)">üîê</div>
          <div class="card-header-text"><h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è–º–∏</h2><p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–æ–≤ –ø–æ —Ä–æ–ª—è–º</p></div>
        </div>
        <div class="card-body">
          <div style="display:flex;flex-direction:column;gap:16px;max-width:400px">
            <div>
              <label style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;display:block;margin-bottom:6px">–ü–∞—Ä–æ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞</label>
              <input type="password" id="pwManager" value="manager" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;outline:none">
            </div>
            <div>
              <label style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;display:block;margin-bottom:6px">–ü–∞—Ä–æ–ª—å –æ—Ç–¥–µ–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</label>
              <input type="password" id="pwBooking" value="booking" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;outline:none">
            </div>
            <div>
              <label style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;display:block;margin-bottom:6px">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
              <input type="password" id="pwAdmin" value="admin" style="width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;font-size:14px;outline:none">
            </div>
            <button class="btn btn-primary" style="width:auto;align-self:flex-start;padding:11px 24px" onclick="savePWs()">üíæ –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª–∏</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PAGE: CLIENT VIEW -->
<div class="page" id="page-client">
  <div style="max-width:720px;margin:0 auto;padding:32px 24px">
    <div id="clientPublicView"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">‚úì <span id="toastMsg"></span></div>

<!-- HIDDEN PDF CONTENT -->
<div id="pdfContent" style="display:none;position:absolute;left:-9999px;top:-9999px"></div>

<script>
// ============================================================
// DATA
// ============================================================
const DEFAULT_PACKAGES = [
  { id:1, name:'–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç 8 —á–∞—Å–æ–≤', price:15000, note:'–º–∏–Ω–∏–≤—ç–Ω, —Ä—É—Å—Å–∫–∏–π –≥–∏–¥, –ª–æ–Ω–≥—Ç–µ–π–ª', type:'standard' },
  { id:2, name:'–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç 5 —á–∞—Å–æ–≤', price:10000, note:'–î–æ–ø. —á–∞—Å —Å–≤–µ—Ä—Ö 5—á ‚Äî 800 ‡∏ø', type:'standard' },
  { id:3, name:'VIP –ø–∞–∫–µ—Ç –ê–ª—å—Ñ–∞—Ä–¥ 8 —á–∞—Å–æ–≤', price:20000, note:'–ú–∏–Ω–∏–≤—ç–Ω –¢–æ–π–æ—Ç–∞ –ê–ª—å—Ñ–∞—Ä–¥', type:'vip' },
  { id:4, name:'VIP –ø–∞–∫–µ—Ç –ê–ª—å—Ñ–∞—Ä–¥ 5 —á–∞—Å–æ–≤', price:14000, note:'–ú–∏–Ω–∏–≤—ç–Ω –¢–æ–π–æ—Ç–∞ –ê–ª—å—Ñ–∞—Ä–¥', type:'vip' },
];

const DEFAULT_OPTIONS = [
  { id:1,  name:'–°—Ç–µ–∫–ª—è–Ω–Ω—ã–π –º–æ—Å—Ç',                                    adultPrice:500,  childPrice:300,  cat:'–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' },
  { id:2,  name:'–°—Ç–µ–∫–ª—è–Ω–Ω—ã–π –º–æ—Å—Ç + –∑–∞–≤—Ç—Ä–∞–∫/–æ–±–µ–¥',                     adultPrice:600,  childPrice:400,  cat:'–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' },
  { id:3,  name:'–ù–∞—Ü. –ø–∞—Ä–∫ –î–∂–µ–π–º—Å–∞ –ë–æ–Ω–¥–∞',                            adultPrice:300,  childPrice:150,  cat:'–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' },
  { id:4,  name:'–ö–∞—Ç–∞–Ω–∏–µ –Ω–∞ –∫–∞–Ω–æ—ç',                                    adultPrice:150,  childPrice:150,  cat:'–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' },
  { id:5,  name:'–•—Ä–∞–º –°—É–≤–∞–Ω–∫—É—Ö–∞ (–æ–±–µ–∑—å—è–Ω—ã)',                           adultPrice:20,   childPrice:20,   cat:'–•—Ä–∞–º—ã' },
  { id:6,  name:'–°–º–æ—Ç—Ä–æ–≤–∞—è –°–∞–º–µ—Ç (–±–µ–∑ –º–æ—Å—Ç–∞)',                         adultPrice:100,  childPrice:100,  cat:'–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' },
  { id:7,  name:'–î–µ—Ä–µ–≤–Ω—è –∫–∞—Ä–µ–Ω–æ–≤',                                     adultPrice:250,  childPrice:200,  cat:'–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ' },
  { id:8,  name:'–î–µ—Ä–µ–≤–Ω—è —Å–ª–æ–Ω–æ–≤',                                      adultPrice:250,  childPrice:200,  cat:'–ñ–∏–≤–æ—Ç–Ω—ã–µ' },
  { id:9,  name:'–ú–∞–Ω—Ç—Ä–∞ –°–ø–∞',                                          adultPrice:990,  childPrice:790,  cat:'–°–ø–∞' },
  { id:10, name:'–û–±–µ–¥ –≤ —Ü—ã–≥–∞–Ω—Å–∫–æ–π –¥–µ—Ä–µ–≤–Ω–µ',                            adultPrice:250,  childPrice:125,  cat:'–ü–∏—Ç–∞–Ω–∏–µ' },
  { id:11, name:'–•—Ä–∞–º –ê–¥–∞ –∏ –†–∞—è',                                      adultPrice:0,    childPrice:0,    cat:'–•—Ä–∞–º—ã' },
  { id:12, name:'–í–æ–¥–æ–ø–∞–¥',                                             adultPrice:100,  childPrice:50,   cat:'–ü—Ä–∏—Ä–æ–¥–∞' },
  { id:13, name:'–ë–µ–ª—ã–π —Ö—Ä–∞–º',                                          adultPrice:0,    childPrice:0,    cat:'–•—Ä–∞–º—ã' },
  { id:14, name:'–ö–∞—Ñ–µ —Å –∫—É–≤—à–∏–Ω–∫–∞–º–∏',                                   adultPrice:0,    childPrice:0,    cat:'–ü–∏—Ç–∞–Ω–∏–µ' },
  { id:15, name:'–ü–ª—è–∂ —Å —Å–∞–º–æ–ª–µ—Ç–∞–º–∏',                                   adultPrice:40,   childPrice:40,   cat:'–ü–ª—è–∂–∏' },
  { id:16, name:'–ì–æ—Ä—è—á–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ù–∞—Ç–∞–π',                             adultPrice:400,  childPrice:200,  cat:'–°–ø–∞' },
  { id:17, name:'–ö—É–ø–∞–Ω–∏–µ —Å–æ —Å–ª–æ–Ω–∞–º–∏ –≤ –º–æ—Ä–µ + –ø—Ä–æ–≥—É–ª–∫–∞',                adultPrice:500,  childPrice:500,  cat:'–ñ–∏–≤–æ—Ç–Ω—ã–µ' },
  { id:18, name:'–ö—É–ø–∞–Ω–∏–µ —Å–æ —Å–ª–æ–Ω–∞–º–∏ –≤ –±–∞—Å—Å–µ–π–Ω–µ + –¥—É—à',                 adultPrice:500,  childPrice:500,  cat:'–ñ–∏–≤–æ—Ç–Ω—ã–µ' },
  { id:19, name:'–ö—É–ø–∞–Ω–∏–µ —Å–æ —Å–ª–æ–Ω–∞–º–∏ (–º–æ—Ä–µ+–±–∞—Å—Å–µ–π–Ω+–ø—Ä–æ–≥—É–ª–∫–∞+–¥—É—à)',      adultPrice:1000, childPrice:1000, cat:'–ñ–∏–≤–æ—Ç–Ω—ã–µ' },
  { id:20, name:'–ö–∞—Ç–∞–Ω–∏–µ –Ω–∞ –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª–∞—Ö',                             adultPrice:500,  childPrice:500,  cat:'–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' },
  { id:21, name:'–°–ø–ª–∞–≤ –Ω–∞ –±–∞–º–±—É–∫–æ–≤—ã—Ö –ø–ª–æ—Ç–∞—Ö',                          adultPrice:150,  childPrice:150,  cat:'–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' },
];

const CAT_ICONS = {
  '–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏': 'üèõÔ∏è',
  '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏': 'üèÑ',
  '–•—Ä–∞–º—ã': '‚õ©Ô∏è',
  '–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ': 'üé≠',
  '–ñ–∏–≤–æ—Ç–Ω—ã–µ': 'üêò',
  '–°–ø–∞': 'üíÜ',
  '–ü–∏—Ç–∞–Ω–∏–µ': 'üçú',
  '–ü—Ä–∏—Ä–æ–¥–∞': 'üåø',
  '–ü–ª—è–∂–∏': 'üèñÔ∏è',
};

const CAT_COLORS = {
  '–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏': '#DBEAFE:#1D4ED8',
  '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏': '#D1FAE5:#065F46',
  '–•—Ä–∞–º—ã': '#FEF3C7:#92400E',
  '–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ': '#EDE9FE:#5B21B6',
  '–ñ–∏–≤–æ—Ç–Ω—ã–µ': '#FCE7F3:#9D174D',
  '–°–ø–∞': '#FDF2F8:#831843',
  '–ü–∏—Ç–∞–Ω–∏–µ': '#FEF9C3:#713F12',
  '–ü—Ä–∏—Ä–æ–¥–∞': '#DCFCE7:#14532D',
  '–ü–ª—è–∂–∏': '#E0F2FE:#0C4A6E',
};

// STATE
let state = {
  role: 'manager',
  passwords: { manager:'manager', booking:'booking', admin:'admin' },
  selectedPackage: null,
  quantities: {},   // { optId: { adult: N, child: N } }
  clientName: '',
  tourDate: '',
  clientPhone: '',
  clientNote: '',
  markupPct: 0,
  markupBat: 0,
  defaultMarkupPct: 0,
  defaultMarkupBat: 0,
  packages: [...DEFAULT_PACKAGES],
  options: [...DEFAULT_OPTIONS],
  activeCat: 'all',
};

// ============================================================
// INIT
// ============================================================
function init() {
  loadFromStorage();
  // Check URL params for client view
  const params = new URLSearchParams(window.location.search);
  if (params.has('view')) {
    try {
      const data = JSON.parse(atob(params.get('view')));
      showClientView(data);
      return;
    } catch(e) {}
  }
  renderPackages();
  renderCatFilters();
  renderOptions();
  renderAdminTables();
  updateSummary();
  
  // Set today's date as default
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('tourDate').value = today;
}

// ============================================================
// STORAGE
// ============================================================
function saveToStorage() {
  localStorage.setItem('phangnga_state', JSON.stringify({
    passwords: state.passwords,
    packages: state.packages,
    options: state.options,
    defaultMarkupPct: state.defaultMarkupPct,
    defaultMarkupBat: state.defaultMarkupBat,
  }));
}

function loadFromStorage() {
  const saved = localStorage.getItem('phangnga_state');
  if (saved) {
    const d = JSON.parse(saved);
    if (d.passwords) state.passwords = d.passwords;
    if (d.packages) state.packages = d.packages;
    if (d.options) state.options = d.options;
    if (d.defaultMarkupPct !== undefined) state.defaultMarkupPct = d.defaultMarkupPct;
    if (d.defaultMarkupBat !== undefined) state.defaultMarkupBat = d.defaultMarkupBat;
  }
}

// ============================================================
// PAGES
// ============================================================
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
}

// ============================================================
// LOGIN
// ============================================================
function showAdminLogin() {
  document.getElementById('loginModal').classList.add('open');
}

function doLogin() {
  const role = document.getElementById('login-role').value;
  const pass = document.getElementById('login-pass').value;
  if (pass === state.passwords[role]) {
    state.role = role;
    closeModal('loginModal');
    document.getElementById('login-pass').value = '';
    applyRole();
    showToast('‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –†–æ–ª—å: ' + getRoleName(role), 'success');
    if (role === 'admin') {
      renderAdminTables();
      showPage('admin');
    }
  } else {
    showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
  }
}

function getRoleName(r) {
  return { manager:'–ú–µ–Ω–µ–¥–∂–µ—Ä', booking:'–û—Ç–¥–µ–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', admin:'–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }[r];
}

function applyRole() {
  const badge = document.getElementById('role-display');
  const adminNav = document.getElementById('btn-admin-nav');
  const loginBtn = document.querySelector('.btn-nav-accent');
  const markupCard = document.getElementById('markupCard');
  
  if (state.role === 'manager') {
    badge.className = 'role-badge role-manager';
    badge.textContent = 'üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä';
    if(adminNav) adminNav.style.display = 'none';
    markupCard.style.display = 'none';
    if(loginBtn){ loginBtn.textContent='üîê –í–æ–π—Ç–∏'; loginBtn.onclick=showAdminLogin; }
  } else if (state.role === 'booking') {
    badge.className = 'role-badge role-booking';
    badge.textContent = 'üìã –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ';
    if(adminNav) adminNav.style.display = 'none';
    markupCard.style.display = 'block';
    document.getElementById('markupPct').value = state.defaultMarkupPct;
    document.getElementById('markupBat').value = state.defaultMarkupBat;
    if(loginBtn){ loginBtn.textContent='üö™ –í—ã–π—Ç–∏'; loginBtn.onclick=logout; }
  } else if (state.role === 'admin') {
    badge.className = 'role-badge role-admin';
    badge.textContent = '‚öôÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
    if(adminNav){ adminNav.style.display='flex'; adminNav.onclick=()=>showPage('admin'); }
    markupCard.style.display = 'block';
    if(loginBtn){ loginBtn.textContent='üö™ –í—ã–π—Ç–∏'; loginBtn.onclick=logout; }
  }
  updateSummary();
}

function logout() {
  state.role = 'manager';
  applyRole();
  showPage('calculator');
  showToast('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// ============================================================
// RENDER PACKAGES
// ============================================================
function renderPackages() {
  const grid = document.getElementById('packagesGrid');
  grid.innerHTML = state.packages.map(pkg => `
    <div class="pkg-card ${pkg.type==='vip'?'vip':''} ${state.selectedPackage===pkg.id?'selected':''}"
         onclick="selectPackage(${pkg.id})">
      <div class="pkg-badge">${pkg.type==='vip'?'‚≠ê VIP':'üîπ –°—Ç–∞–Ω–¥–∞—Ä—Ç'}</div>
      <div class="pkg-name">${pkg.name}</div>
      <div class="pkg-note">${pkg.note}</div>
      <div class="pkg-price">${fmt(pkg.price)} <span>‡∏ø / –≥—Ä—É–ø–ø–∞</span></div>
    </div>
  `).join('');
}

function selectPackage(id) {
  state.selectedPackage = state.selectedPackage === id ? null : id;
  renderPackages();
  updateSummary();
}

// ============================================================
// RENDER CATEGORY FILTERS
// ============================================================
function renderCatFilters() {
  const cats = ['all', ...new Set(state.options.map(o => o.cat))];
  document.getElementById('catFilters').innerHTML = cats.map(c => `
    <button class="cat-btn ${state.activeCat===c?'active':''}" onclick="setCat('${c}')">
      ${c==='all'?'üåê –í—Å–µ':(CAT_ICONS[c]||'')+ ' ' +c}
    </button>
  `).join('');
}

function setCat(cat) {
  state.activeCat = cat;
  renderCatFilters();
  renderOptions();
}

// ============================================================
// RENDER OPTIONS
// ============================================================
function renderOptions() {
  const filtered = state.activeCat === 'all'
    ? state.options
    : state.options.filter(o => o.cat === state.activeCat);

  const tbody = document.getElementById('optionsBody');
  tbody.innerHTML = filtered.map(opt => {
    const q = state.quantities[opt.id] || { adult:0, child:0 };
    const sum = (q.adult||0)*opt.adultPrice + (q.child||0)*opt.childPrice;
    const hasQty = (q.adult||0)+(q.child||0) > 0;
    const [bg, fg] = (CAT_COLORS[opt.cat]||'#F1F5F9:#64748B').split(':');
    return `
      <tr class="opt-row ${hasQty?'has-qty':''}" id="optrow-${opt.id}">
        <td>
          <div class="opt-name">${opt.name}</div>
          <span class="opt-cat-tag" style="background:${bg};color:${fg}">${CAT_ICONS[opt.cat]||''} ${opt.cat}</span>
        </td>
        <td style="text-align:center">
          <input class="qty-input" type="number" min="0" max="99" value="${q.adult||''}"
            placeholder="0"
            oninput="setQty(${opt.id},'adult',this.value)">
        </td>
        <td style="text-align:center">
          <input class="qty-input" type="number" min="0" max="99" value="${q.child||''}"
            placeholder="0"
            oninput="setQty(${opt.id},'child',this.value)">
        </td>
        <td class="opt-price">${opt.adultPrice>0?fmt(opt.adultPrice)+' ‡∏ø':'<span class="opt-price-free">FREE</span>'}</td>
        <td class="opt-price">${opt.childPrice>0?fmt(opt.childPrice)+' ‡∏ø':'<span class="opt-price-free">FREE</span>'}</td>
        <td class="opt-sum ${sum===0?'zero':''}" id="optsum-${opt.id}">${sum>0?fmt(sum)+' ‡∏ø':'‚Äî'}</td>
      </tr>
    `;
  }).join('');
}

function setQty(id, type, val) {
  if (!state.quantities[id]) state.quantities[id] = { adult:0, child:0 };
  state.quantities[id][type] = parseInt(val)||0;
  updateSummary();
  // Update row highlight
  const q = state.quantities[id];
  const opt = state.options.find(o=>o.id===id);
  if (opt) {
    const sum = (q.adult||0)*opt.adultPrice + (q.child||0)*opt.childPrice;
    const row = document.getElementById('optrow-'+id);
    const sumEl = document.getElementById('optsum-'+id);
    if (row) {
      row.classList.toggle('has-qty', (q.adult||0)+(q.child||0)>0);
    }
    if (sumEl) {
      sumEl.textContent = sum>0 ? fmt(sum)+' ‡∏ø' : '‚Äî';
      sumEl.className = 'opt-sum ' + (sum===0?'zero':'');
    }
  }
}

// ============================================================
// SUMMARY
// ============================================================
function updateSummary() {
  const pkg = state.packages.find(p=>p.id===state.selectedPackage);
  const pkgPrice = pkg ? pkg.price : 0;

  let optTotal = 0;
  state.options.forEach(opt => {
    const q = state.quantities[opt.id]||{adult:0,child:0};
    optTotal += (q.adult||0)*opt.adultPrice + (q.child||0)*opt.childPrice;
  });

  const sub = pkgPrice + optTotal;
  const markupPct = parseFloat(document.getElementById('markupPct')?.value)||0;
  const markupBat = parseFloat(document.getElementById('markupBat')?.value)||0;
  const markupCalc = Math.round(sub * markupPct/100) + markupBat;
  const total = sub + markupCalc;

  document.getElementById('sumPackage').textContent = fmt(pkgPrice)+' ‡∏ø';
  document.getElementById('sumOptions').textContent = fmt(optTotal)+' ‡∏ø';
  document.getElementById('sumTotal').textContent = fmt(total)+' ‡∏ø';

  const markupRow = document.getElementById('sumMarkupRow');
  if ((state.role==='booking'||state.role==='admin') && (markupPct>0||markupBat>0)) {
    markupRow.style.display = 'flex';
    document.getElementById('sumMarkup').textContent = '+'+fmt(markupCalc)+' ‡∏ø';
  } else {
    markupRow.style.display = 'none';
  }

  // Selected opts list
  const list = document.getElementById('selectedOptsList');
  const selected = state.options.filter(opt => {
    const q = state.quantities[opt.id]||{};
    return (q.adult||0)+(q.child||0) > 0;
  });

  let html = '';
  if (pkg) {
    html += `<div class="sel-opt">
      <div><div class="sel-opt-name">üöê ${pkg.name}</div><div class="sel-opt-detail">${pkg.note}</div></div>
      <div class="sel-opt-price">${fmt(pkgPrice)} ‡∏ø</div>
    </div>`;
  }
  selected.forEach(opt => {
    const q = state.quantities[opt.id];
    const sum = (q.adult||0)*opt.adultPrice + (q.child||0)*opt.childPrice;
    const detail = [q.adult>0?`–≤–∑—Ä: ${q.adult}`:'', q.child>0?`–¥–µ—Ç: ${q.child}`:''].filter(Boolean).join(', ');
    html += `<div class="sel-opt">
      <div>
        <div class="sel-opt-name">${CAT_ICONS[opt.cat]||'‚Ä¢'} ${opt.name}</div>
        <div class="sel-opt-detail">${detail}</div>
      </div>
      <div class="sel-opt-price">${fmt(sum)} ‡∏ø</div>
    </div>`;
  });

  if (!pkg && selected.length===0) {
    list.innerHTML = `<div class="empty-state"><div class="icon">üéØ</div><p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –æ–ø—Ü–∏–∏</p></div>`;
  } else {
    list.innerHTML = html;
  }
}

// ============================================================
// COLLECT DATA
// ============================================================
function collectData() {
  const pkg = state.packages.find(p=>p.id===state.selectedPackage);
  const opts = state.options.filter(opt=>{
    const q=state.quantities[opt.id]||{};
    return (q.adult||0)+(q.child||0)>0;
  }).map(opt=>{
    const q=state.quantities[opt.id];
    const sum=(q.adult||0)*opt.adultPrice+(q.child||0)*opt.childPrice;
    return {...opt, qty:q, sum};
  });

  const pkgPrice = pkg?pkg.price:0;
  const optTotal = opts.reduce((a,o)=>a+o.sum,0);
  const sub = pkgPrice+optTotal;
  const markupPct = parseFloat(document.getElementById('markupPct')?.value)||0;
  const markupBat = parseFloat(document.getElementById('markupBat')?.value)||0;
  const markupCalc = Math.round(sub*markupPct/100)+markupBat;
  const total = sub+markupCalc;

  return {
    clientName: document.getElementById('clientName').value,
    tourDate: document.getElementById('tourDate').value,
    clientPhone: document.getElementById('clientPhone').value,
    clientNote: document.getElementById('clientNote').value,
    package: pkg,
    options: opts,
    pkgPrice, optTotal, markupPct, markupBat, markupCalc, total,
    generated: new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'}),
  };
}

// ============================================================
// PDF
// ============================================================
function downloadPDF() {
  const d = collectData();
  const html = buildPDFHTML(d, false);
  document.getElementById('pdfContent').innerHTML = html;
  document.getElementById('pdfContent').style.display = 'block';
  const el = document.getElementById('pdfContent');
  const opt = {
    margin: [10,10,10,10],
    filename: `–¢—É—Ä_–ü—Ö–∞–Ω–≥–ù–≥–∞_${d.clientName||'–∫–ª–∏–µ–Ω—Ç'}_${d.tourDate||'–¥–∞—Ç–∞'}.pdf`,
    image: { type:'jpeg', quality:0.95 },
    html2canvas: { scale:2, useCORS:true },
    jsPDF: { unit:'mm', format:'a4', orientation:'portrait' }
  };
  html2pdf().set(opt).from(el).save().then(()=>{
    document.getElementById('pdfContent').style.display = 'none';
    showToast('‚úÖ PDF —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!', 'success');
  });
}

function downloadClientPDF() {
  const d = collectData();
  const html = buildPDFHTML(d, true);
  document.getElementById('pdfContent').innerHTML = html;
  document.getElementById('pdfContent').style.display = 'block';
  const opt = {
    margin: [10,10,10,10],
    filename: `–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ_–¢—É—Ä_–ü—Ö–∞–Ω–≥–ù–≥–∞_${d.clientName||'–∫–ª–∏–µ–Ω—Ç'}.pdf`,
    image: { type:'jpeg', quality:0.95 },
    html2canvas: { scale:2, useCORS:true },
    jsPDF: { unit:'mm', format:'a4', orientation:'portrait' }
  };
  html2pdf().set(opt).from(document.getElementById('pdfContent')).save().then(()=>{
    document.getElementById('pdfContent').style.display = 'none';
  });
}

function buildPDFHTML(d, clientView) {
  const optRows = (d.options||[]).map(o=>`
    <tr>
      <td>${o.name}</td>
      <td style="text-align:center">${o.qty.adult||0}</td>
      <td style="text-align:center">${o.qty.child||0}</td>
      <td style="text-align:right">${fmt(o.adultPrice)} ‡∏ø</td>
      <td style="text-align:right">${fmt(o.childPrice)} ‡∏ø</td>
      <td style="text-align:right;font-weight:700">${fmt(o.sum)} ‡∏ø</td>
    </tr>
  `).join('');

  const markupRow = (!clientView && (d.markupPct>0||d.markupBat>0)) ? `
    <tr style="background:#FEF3C7">
      <td colspan="5" style="font-weight:600;color:#92400E">–ù–∞—Ü–µ–Ω–∫–∞ (${d.markupPct}% + ${fmt(d.markupBat)}‡∏ø)</td>
      <td style="text-align:right;font-weight:700;color:#92400E">+${fmt(d.markupCalc)} ‡∏ø</td>
    </tr>
  ` : '';

  return `
    <div style="font-family:'Inter',Arial,sans-serif;padding:32px;max-width:700px;margin:0 auto;color:#1E293B">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;padding-bottom:20px;border-bottom:2px solid #0F4C75">
        <div>
          <div style="font-size:24px;font-weight:800;color:#0F4C75">üå¥ –ü—Ö–∞–Ω–≥ –ù–≥–∞ –¢—É—Ä—ã</div>
          <div style="font-size:13px;color:#64748B;margin-top:4px">–¢–∞–π–ª–∞–Ω–¥ ¬∑ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—É—Ä—ã</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:20px;font-weight:700">–†–∞—Å—á—ë—Ç —Ç—É—Ä–∞</div>
          <div style="font-size:12px;color:#64748B;margin-top:2px">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ: ${d.generated}</div>
        </div>
      </div>

      <div style="background:#F0F5FA;border-radius:10px;padding:16px;margin-bottom:24px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
        ${d.clientName?`<div><span style="font-weight:600;color:#64748B;font-size:11px;text-transform:uppercase">–ö–ª–∏–µ–Ω—Ç</span><div style="font-weight:700;font-size:14px;margin-top:3px">${d.clientName}</div></div>`:''}
        ${d.tourDate?`<div><span style="font-weight:600;color:#64748B;font-size:11px;text-transform:uppercase">–î–∞—Ç–∞ —Ç—É—Ä–∞</span><div style="font-weight:700;font-size:14px;margin-top:3px">${formatDate(d.tourDate)}</div></div>`:''}
        ${d.clientPhone?`<div><span style="font-weight:600;color:#64748B;font-size:11px;text-transform:uppercase">–¢–µ–ª–µ—Ñ–æ–Ω</span><div style="font-weight:700;font-size:14px;margin-top:3px">${d.clientPhone}</div></div>`:''}
        ${d.clientNote?`<div style="grid-column:1/-1"><span style="font-weight:600;color:#64748B;font-size:11px;text-transform:uppercase">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span><div style="font-size:13px;margin-top:3px">${d.clientNote}</div></div>`:''}
      </div>

      ${d.package?`
        <div style="background:linear-gradient(135deg,#0F4C75,#1B6CA8);color:white;border-radius:10px;padding:16px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-size:11px;opacity:0.8;text-transform:uppercase;margin-bottom:4px">–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</div>
            <div style="font-size:16px;font-weight:700">${d.package.name}</div>
            <div style="font-size:12px;opacity:0.8;margin-top:3px">${d.package.note}</div>
          </div>
          <div style="font-size:22px;font-weight:800">${fmt(d.pkgPrice)} ‡∏ø</div>
        </div>
      `:''}

      ${d.options&&d.options.length>0?`
        <div style="margin-bottom:20px">
          <div style="font-size:14px;font-weight:700;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #E2E8F0">üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</div>
          <table style="width:100%;border-collapse:collapse;font-size:12px">
            <thead>
              <tr style="background:#F8FAFF">
                <th style="padding:9px 10px;text-align:left;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–û–ø—Ü–∏—è</th>
                <th style="padding:9px 10px;text-align:center;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–í–∑—Ä.</th>
                <th style="padding:9px 10px;text-align:center;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–î–µ—Ç.</th>
                <th style="padding:9px 10px;text-align:right;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–¶–µ–Ω–∞ –≤–∑—Ä.</th>
                <th style="padding:9px 10px;text-align:right;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–¶–µ–Ω–∞ –¥–µ—Ç.</th>
                <th style="padding:9px 10px;text-align:right;font-size:10px;text-transform:uppercase;color:#64748B;border-bottom:2px solid #E2E8F0">–°—É–º–º–∞</th>
              </tr>
            </thead>
            <tbody>${optRows}</tbody>
          </table>
        </div>
      `:''}

      <table style="width:100%;border-collapse:collapse;margin-bottom:16px;font-size:13px">
        <tr style="background:#F8FAFF">
          <td colspan="5" style="padding:10px 12px;font-weight:600;color:#64748B">–ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</td>
          <td style="padding:10px 12px;text-align:right;font-weight:700">${fmt(d.pkgPrice)} ‡∏ø</td>
        </tr>
        <tr>
          <td colspan="5" style="padding:10px 12px;font-weight:600;color:#64748B">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</td>
          <td style="padding:10px 12px;text-align:right;font-weight:700">${fmt(d.optTotal)} ‡∏ø</td>
        </tr>
        ${markupRow}
      </table>

      <div style="background:linear-gradient(135deg,#0F4C75,#1B6CA8);color:white;border-radius:12px;padding:20px 24px;display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:14px;font-weight:600;opacity:0.9">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
          <div style="font-size:12px;opacity:0.75;margin-top:2px">—Ç–∞–π—Å–∫–∏—Ö –±–∞—Ç (THB)</div>
        </div>
        <div style="font-size:32px;font-weight:800">${fmt(d.total)} ‡∏ø</div>
      </div>

      <div style="margin-top:20px;text-align:center;font-size:11px;color:#94A3B8">
        –†–∞—Å—á—ë—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ¬∑ –ü—Ö–∞–Ω–≥ –ù–≥–∞ –¢—É—Ä—ã ¬∑ –¢–∞–π–ª–∞–Ω–¥
      </div>
    </div>
  `;
}

// ============================================================
// TEXT FORMAT
// ============================================================
function showTextFormat() {
  const d = collectData();
  const lines = [
    'üå¥ *–†–ê–°–ß–Å–¢ –¢–£–†–ê ‚Äî –ü–•–ê–ù–ì –ù–ì–ê*',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    d.clientName ? `üë§ –ö–ª–∏–µ–Ω—Ç: ${d.clientName}` : '',
    d.tourDate ? `üìÖ –î–∞—Ç–∞: ${formatDate(d.tourDate)}` : '',
    d.clientPhone ? `üì± –¢–µ–ª–µ—Ñ–æ–Ω: ${d.clientPhone}` : '',
    '',
  ].filter(l => l !== null);

  if (d.package) {
    lines.push('üöê *–ë–ê–ó–û–í–´–ô –ü–ê–ö–ï–¢*');
    lines.push(`‚Ä¢ ${d.package.name} ‚Äî ${fmt(d.pkgPrice)} ‡∏ø`);
    lines.push(`  (${d.package.note})`);
    lines.push('');
  }

  if (d.options && d.options.length > 0) {
    lines.push('üéØ *–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ü–¶–ò–ò*');
    d.options.forEach(o => {
      const detail = [o.qty.adult>0?`${o.qty.adult} –≤–∑—Ä.`:'', o.qty.child>0?`${o.qty.child} –¥–µ—Ç.`:''].filter(Boolean).join(', ');
      lines.push(`‚Ä¢ ${o.name} (${detail}) ‚Äî ${fmt(o.sum)} ‡∏ø`);
    });
    lines.push('');
  }

  lines.push('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  lines.push(`üí≥ *–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï: ${fmt(d.total)} ‡∏ø*`);
  lines.push('');
  lines.push('_–¶–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –≤ —Ç–∞–π—Å–∫–∏—Ö –±–∞—Ç–∞—Ö (THB)_');
  lines.push('_–ü—Ö–∞–Ω–≥ –ù–≥–∞ –¢—É—Ä—ã ¬∑ –¢–∞–π–ª–∞–Ω–¥_');

  if (d.clientNote) {
    lines.push('');
    lines.push(`üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: ${d.clientNote}`);
  }

  document.getElementById('textOutput').textContent = lines.filter(l=>l!=='').join('\n');
  document.getElementById('textModal').classList.add('open');
}

function copyText() {
  const text = document.getElementById('textOutput').textContent;
  navigator.clipboard.writeText(text).then(() => {
    showToast('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
  });
}

// ============================================================
// SHARE LINK
// ============================================================
function generateLink() {
  const d = collectData();
  const payload = btoa(encodeURIComponent(JSON.stringify(d)));
  const url = window.location.origin + window.location.pathname + '?view=' + payload;
  document.getElementById('shareUrlInput').value = url;
  document.getElementById('linkModal').classList.add('open');
}

function copyLink() {
  const url = document.getElementById('shareUrlInput').value;
  navigator.clipboard.writeText(url).then(() => {
    showToast('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
  });
}

// ============================================================
// CLIENT VIEW
// ============================================================
function showClientView(data) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-client').classList.add('active');

  const html = buildClientViewHTML(data);
  document.getElementById('clientPublicView').innerHTML = html;

  // Update header for client view
  document.querySelector('.logo-sub').textContent = '–í–∞—à —Ä–∞—Å—á—ë—Ç —Ç—É—Ä–∞';
  document.querySelector('.header-nav').innerHTML = `
    <span style="font-size:12px;opacity:0.8">üìÑ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å—á—ë—Ç–∞</span>
  `;
}

function buildClientViewHTML(d) {
  const optRows = (d.options||[]).map(o=>`
    <div class="sel-opt" style="margin-bottom:8px">
      <div>
        <div class="sel-opt-name">${o.name}</div>
        <div class="sel-opt-detail">${[o.qty&&o.qty.adult>0?`${o.qty.adult} –≤–∑—Ä.`:'',o.qty&&o.qty.child>0?`${o.qty.child} –¥–µ—Ç.`:''].filter(Boolean).join(', ')}</div>
      </div>
      <div class="sel-opt-price">${fmt(o.sum)} ‡∏ø</div>
    </div>
  `).join('');

  return `
    <div style="text-align:center;margin-bottom:32px">
      <div style="font-size:32px;margin-bottom:8px">üå¥</div>
      <h1 style="font-size:24px;font-weight:800;color:var(--primary)">–í–∞—à —Ç—É—Ä –≤ –ü—Ö–∞–Ω–≥ –ù–≥–∞</h1>
      <p style="color:var(--text-light);margin-top:6px">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –≤–∞—Å</p>
    </div>

    <div class="card" style="margin-bottom:16px">
      <div class="card-body">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          ${d.clientName?`<div><div style="font-size:11px;font-weight:700;color:var(--text-light);text-transform:uppercase;margin-bottom:4px">–ö–ª–∏–µ–Ω—Ç</div><div style="font-weight:700">${d.clientName}</div></div>`:''}
          ${d.tourDate?`<div><div style="font-size:11px;font-weight:700;color:var(--text-light);text-transform:uppercase;margin-bottom:4px">–î–∞—Ç–∞ —Ç—É—Ä–∞</div><div style="font-weight:700">${formatDate(d.tourDate)}</div></div>`:''}
        </div>
      </div>
    </div>

    ${d.package?`
    <div class="card" style="margin-bottom:16px">
      <div class="card-body">
        <div style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;margin-bottom:10px">üöê –ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700;font-size:15px">${d.package.name}</div>
            <div style="font-size:12px;color:var(--text-light);margin-top:3px">${d.package.note}</div>
          </div>
          <div style="font-size:20px;font-weight:800;color:var(--primary)">${fmt(d.pkgPrice)} ‡∏ø</div>
        </div>
      </div>
    </div>
    `:''}

    ${d.options&&d.options.length>0?`
    <div class="card" style="margin-bottom:16px">
      <div class="card-body">
        <div style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;margin-bottom:12px">üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏</div>
        ${optRows}
      </div>
    </div>
    `:''}

    <div style="background:linear-gradient(135deg,var(--primary),var(--primary-light));color:white;border-radius:var(--radius);padding:24px;text-align:center;margin-bottom:20px">
      <div style="font-size:13px;opacity:0.85;margin-bottom:8px">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
      <div style="font-size:40px;font-weight:800">${fmt(d.total)} ‡∏ø</div>
      <div style="font-size:12px;opacity:0.75;margin-top:6px">—Ç–∞–π—Å–∫–∏—Ö –±–∞—Ç (THB)</div>
    </div>

    ${d.clientNote?`
    <div class="card" style="margin-bottom:16px">
      <div class="card-body">
        <div style="font-size:12px;font-weight:700;color:var(--text-light);text-transform:uppercase;margin-bottom:6px">üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</div>
        <div style="font-size:13px">${d.clientNote}</div>
      </div>
    </div>
    `:''}
  `;
}

// ============================================================
// ADMIN TABLES
// ============================================================
function renderAdminTables() {
  // Packages
  document.getElementById('adminPackagesTable').innerHTML = state.packages.map((p,i)=>`
    <tr>
      <td style="width:30px;text-align:center;font-weight:600;color:var(--text-light)">${p.id}</td>
      <td class="name-col"><input type="text" value="${p.name}" oninput="state.packages[${i}].name=this.value" style="width:100%"></td>
      <td style="width:130px"><input type="number" value="${p.price}" oninput="state.packages[${i}].price=parseInt(this.value)||0" style="width:100%"></td>
      <td><input type="text" value="${p.note}" oninput="state.packages[${i}].note=this.value" style="width:100%"></td>
    </tr>
  `).join('');

  // Options
  document.getElementById('adminOptionsTable').innerHTML = state.options.map((o,i)=>`
    <tr>
      <td style="width:30px;text-align:center;font-weight:600;color:var(--text-light)">${o.id}</td>
      <td class="name-col"><input type="text" value="${o.name}" oninput="state.options[${i}].name=this.value" style="width:100%"></td>
      <td style="width:100px"><input type="number" value="${o.adultPrice}" oninput="state.options[${i}].adultPrice=parseInt(this.value)||0"></td>
      <td style="width:100px"><input type="number" value="${o.childPrice}" oninput="state.options[${i}].childPrice=parseInt(this.value)||0"></td>
      <td style="width:150px"><input type="text" value="${o.cat}" oninput="state.options[${i}].cat=this.value"></td>
    </tr>
  `).join('');

  // Markup defaults
  if (document.getElementById('defaultMarkupPct'))
    document.getElementById('defaultMarkupPct').value = state.defaultMarkupPct;
  if (document.getElementById('defaultMarkupBat'))
    document.getElementById('defaultMarkupBat').value = state.defaultMarkupBat;
}

function saveAdminSettings() {
  state.defaultMarkupPct = parseFloat(document.getElementById('defaultMarkupPct')?.value)||0;
  state.defaultMarkupBat = parseFloat(document.getElementById('defaultMarkupBat')?.value)||0;
  saveToStorage();
  renderPackages();
  renderCatFilters();
  renderOptions();
  updateSummary();
  showToast('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
}

function savePWs() {
  state.passwords.manager = document.getElementById('pwManager').value || 'manager';
  state.passwords.booking = document.getElementById('pwBooking').value || 'booking';
  state.passwords.admin = document.getElementById('pwAdmin').value || 'admin';
  saveToStorage();
  showToast('‚úÖ –ü–∞—Ä–æ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
}

function switchAdminTab(name) {
  document.querySelectorAll('.admin-tab').forEach((t,i) => {
    const tabs = ['prices','options','markup','access'];
    t.classList.toggle('active', tabs[i]===name);
  });
  document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
}

// ============================================================
// UTILS
// ============================================================
function fmt(n) {
  return (n||0).toLocaleString('ru-RU');
}

function formatDate(d) {
  if (!d) return '';
  const [y,m,day] = d.split('-');
  const months = ['—è–Ω–≤–∞—Ä—è','—Ñ–µ–≤—Ä–∞–ª—è','–º–∞—Ä—Ç–∞','–∞–ø—Ä–µ–ª—è','–º–∞—è','–∏—é–Ω—è','–∏—é–ª—è','–∞–≤–≥—É—Å—Ç–∞','—Å–µ–Ω—Ç—è–±—Ä—è','–æ–∫—Ç—è–±—Ä—è','–Ω–æ—è–±—Ä—è','–¥–µ–∫–∞–±—Ä—è'];
  return `${parseInt(day)} ${months[parseInt(m)-1]} ${y}`;
}

function resetAll() {
  state.selectedPackage = null;
  state.quantities = {};
  document.getElementById('clientName').value = '';
  document.getElementById('tourDate').value = new Date().toISOString().split('T')[0];
  document.getElementById('clientPhone').value = '';
  document.getElementById('clientNote').value = '';
  if (document.getElementById('markupPct')) document.getElementById('markupPct').value = 0;
  if (document.getElementById('markupBat')) document.getElementById('markupBat').value = 0;
  renderPackages();
  renderOptions();
  updateSummary();
  showToast('üîÑ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–±—Ä–æ—à–µ–Ω');
}

function showToast(msg, type='') {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.className = 'toast show ' + type;
  setTimeout(() => t.className='toast', 3000);
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', function(e) {
    if (e.target === this) this.classList.remove('open');
  });
});

// ============================================================
// BOOT
// ============================================================
init();
</script>
</body>
</html>
